# Keymeleon
<a href="https://github.com/loftyshaky/keymeleon/tags"><img src="https://img.shields.io/github/v/tag/loftyshaky/keymeleon?label=Version&color=blue" alt="Version"></a> <img src="https://img.shields.io/badge/AutoHotkey-2.0+-purple.svg" alt="AutoHotkey"> <a href="LICENSE.md"><img src="https://img.shields.io/badge/License-MIT-orange.svg" alt="License: MIT"></a> <img src="https://img.shields.io/github/downloads/loftyshaky/keymeleon/total?label=Downloads%20&color=green" alt="GitHub all releases"> <img src="https://img.shields.io/github/downloads/loftyshaky/keymeleon/latest/total?sort=date&label=Downloads@Latest&color=green" alt="GitHub Release">

Keymeleon — это мощный скрипт AutoHotkey, который кардинально меняет управление раскладками клавиатуры в Windows. Он избавляет от неудобств ручного переключения раскладок, предоставляя интеллектуальную автоматизацию, настраиваемые горячие клавиши и богатую звуковую обратную связь.

<h2 id="links">Ссылки</h2>

[Последняя версия](https://github.com/loftyshaky/keymeleon/releases/latest)<br>
[README.md in English](README.md)<br>
[Благодарности](CREDITS.md)<br>
[Лицензия](LICENSE.md)

## Возможности

**Выделенные горячие клавиши для раскладок** — Назначайте отдельные клавиши или комбинации для мгновенного переключения на нужные раскладки. Например, установите `Ctrl+Shift+F8` для Дворака и `Ctrl+Shift+F9` для QWERTY.

**Последовательное переключение раскладок** — Быстро переключайтесь между основной и дополнительными раскладками.

**Звуковые уведомления** — Уникальные звуки при переключении раскладок и индивидуальные звуки печати для каждой раскладки.

**Автоматическое переключение раскладки для приложений** — Раскладка клавиатуры автоматически подстраивается под активное приложение. Играйте в игры с QWERTY для лучшей совместимости, затем мгновенно возвращайтесь к Двораку для работы — всё без нажатия дополнительных клавиш.

**Переназначение клавиш для приложений** — Настраивайте разные действия для клавиш в разных программах. Создавайте пользовательские схемы, которые работают только в определённых приложениях — например, назначайте боковые кнопки мыши для MMO на цифровые клавиши только в играх, сохраняя их стандартные функции в других программах.

**Универсальные сочетания клавиш для всех раскладок** - Создавайте универсальные сочетания клавиш Windows, которые работают на основе физического расположения клавиш, а не символов конкретной раскладки. Нажимайте одни и те же физические клавиши для Копирования, Вставки, Выделения всего и т.д., независимо от активной раскладки (QWERTY, Дворак и др.).

**Продвинутые макросы** — Создавайте сложные последовательности клавиш с точной настройкой пауз между нажатием клавиш.

<h2 id="table_of_contents">Содержание</h2>

- [Системные требования](#system_requirements)
- [Быстрый старт](#quick_start)
- [Пользовательская папка и файлы конфигурации](#user_directory_and_configuration_files)
- [Пример конфигурации](#configuration_example)
- [Методы переключения раскладок](#layout_switching_methods)
- [Техники переключения раскладок](#layout_switching_techniques)
- [Звуковая обратная связь](#audio_feedback)
- [Функции](#features_reference)
- [Условные раскладки](#conditional_layouts)
- [Контекстное переназначение клавиш](#context_key_remapping)
- [Макросы](#macros)
- [Поддержка кнопок мыши](#mouse_button_support)
- [Переназначение клавиш и горячих клавиш клавиатуры](#remapping_keyboard_keys_and_hotkeys)
- [Справочник](#reference)

<h2 id="system_requirements">Системные требования</h2>

- Windows 10/11
- [AutoHotkey v2.0+](https://www.autohotkey.com)

<h2 id="quick_start">Быстрый старт</h2>

1. Установите [AutoHotkey v2.0](https://www.autohotkey.com), если вы ещё этого не сделали.

2. Скачайте [последний релиз](https://github.com/loftyshaky/keymeleon/releases/latest) и распакуйте его в предпочитаемое место.

3. Запустите `keymeleon.ahk` от имени администратора, чтобы начать работу со скриптом.

<h2 id="user_directory_and_configuration_files">Пользовательская папка и файлы настроек</h2>

### Структура пользовательской папки

При первом запуске Keymeleon создаёт специальную пользовательскую папку в `C:\Documents\Keymeleon\`, содержащую все ваши настройки и аудиофайлы:

```text
Keymeleon/
├── config.json           # Основной файл конфигурации со всеми настройками.
├── audio/
│   ├── layout_switching/ # Звуки переключения раскладок.
│   ├── typing/           # Уникальные звуки печати для каждой раскладки.
│   └── feature_state/    # Звуки для включения/выключения функций.
```

Keymeleon использует два отдельных JSON файла конфигурации для разных целей:

### Конфиг расположения пользовательской папки

- Необязателен.

- Расположение: Та же папка, где находится скрипт Keymeleon.

- Назначение: Только задаёт расположение пользовательской папки.

- Может содержать только одно свойство: `user_dir`.

- Должен быть создан до первого запуска.

### Основной конфиг

- Обязателен.

- Расположение: Внутри пользовательской папки Keymeleon (`C:\Documents\Keymeleon\` по умолчанию).

- Назначение: Хранит все ваши настройки, горячие клавиши, раскладки и аудиопараметры.

- Создаётся автоматически после первого запуска.

Важно: После изменения этого файла перезапустите keymeleon.ahk, чтобы изменения вступили в силу.

### Настройка расположения пользовательской папки

Чтобы изменить расположение пользовательской папки, создайте файл `config.json` в папке скрипта с содержимым ниже, затем запустите Keymeleon:

```json
{
    "user_dir": "D:\\Ваш\\Пользовательский\\Путь"
}
```

#### Важные примечания

- Используйте двойные обратные слеши (`\\`) в путях к файлам.

- Этот файл может иметь только одно свойство: `user_dir`.

- После установки этого параметра полная структура пользовательской папки будет создана в вашем пользовательском расположении при запуске Keymeleon.

<h2 id="configuration_example">Пример конфигурации</h2> 

Полнофункциональный пример конфигурации:

```json
{
    "audio": {
        "default_file_extension": "wav"
    },
    "features": {
        "enable_all_bindings": 1,
        "enable_dedicated_layout_switching": 1,
        "enable_feature_state_audio": 1,
        "enable_layout_switching_audio": 1,
        "enable_sequential_layout_switching": 1,
        "enable_typing_audio": 1,
        "enable_windows_api_layout_switching": 1
    },
    "hotkeys": {
        "dedicated_layout_hotkeys": ["^+F8", "^+F9", "^+F10", "^+F11"],
        "display_current_layout_id": "^!+sc017",
        "set_primary_layout": "ScrollLock",
        "set_secondary_layout": "Pause",
        "toggle_all_bindings": "^!+sc035",
        "toggle_dedicated_layout_switching": "^!+sc01A",
        "toggle_feature_state_audio": "^!+sc032",
        "toggle_layout_switching_audio": "^!+sc034",
        "toggle_sequential_layout_switching": "^!+sc01B",
        "toggle_typing_audio": "^!+sc033",
        "toggle_windows_api_layout_switching": "^!+sc019"
    },
    "layouts": {
        "all_layouts_ordered": ["en-DVORAK", "en-US", "es-ES", "de-DE"],
        "fallback_layout_switching_exes": ["x360ce"],
        "layout_ids": ["-268303351", "67699721", "67767306", "67568647"],
        "layout_switching_delay": 30,
        "primary_layout": "en-DVORAK",
        "secondary_layouts": ["en-US", "es-ES", "de-DE"]
    }
}
```

### Пример из реального сценария

Для сложных настроек, включая специализированные раскладки под приложения, пользовательские привязки клавиш и расширенные настройки кнопок мыши, изучите пример полной конфигурации в папке [example-config](example-config/).

<h2 id="layout_switching_methods">Методы переключения раскладок</h2>

Keymeleon предоставляет два мощных метода переключения между раскладками клавиатуры, давая вам как быстрое последовательное переключение, так и мгновенный доступ к любой раскладке.

### Методы переключения

| Метод                     | Описание                                                                                        | Сценарий использования                                                                          |
| :------------------------- | :------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------- |
| Последовательное переключение       | Быстро переключитесь на основную раскладку или последовательно перебирайте второстепенные с помощью двух выделенных клавиш. | Идеально для пользователей, которые часто переключаются между основной и 1-2 альтернативными раскладками. |
| Переключение по выделенным горячим клавишам | Назначьте конкретные сочетания клавиш для прямого переключения на отдельные раскладки.                       | Идеально для пользователей, которым нужен мгновенный доступ к нескольким конкретным раскладкам.           |

Последовательное переключение позволяет нажать одну клавишу (например, `ScrollLock`), чтобы перейти к основной раскладке (например, Дворак) независимо от текущей раскладки, и другую клавишу (например, `Pause`), чтобы последовательно перебирать второстепенные раскладки (такие как QWERTY, Испанская раскладка, Немецкая раскладка).

Переключение по выделенным горячим клавишам даёт каждой раскладке собственное сочетание клавиш (например, `Ctrl+Shift+F8` для Дворака, `Ctrl+Shift+F9` для QWERTY), обеспечивая мгновенный доступ одним нажатием.


### Параметры конфигурации

| Параметр                     | Объект    | Тип     | Описание                                                                                     | Пример                                              |
| :-------------------------- | :-------- | :------- | :---------------------------------------------------------------------------------------------- | :--------------------------------------------------- |
| `all_layouts_ordered`       | `layouts` | `Array`  | Названия всех раскладок в точном порядке языковой панели Windows. Названия должны быть уникальными.                | `["en-DVORAK", "en-US", "es-ES", "de-DE"]`           |
| `layout_ids`                | `layouts` | `Array`  | ID раскладок, соответствующие `all_layouts_ordered`. Получить ID можно с помощью `Ctrl+Shift+Alt+I`.             | `["-268303351", "67699721", "67767306", "67568647"]` |
| `primary_layout`            | `layouts` | `String` | Название вашей раскладки по умолчанию из `all_layouts_ordered`.                                            | `"en-DVORAK"`                                        |
| `secondary_layouts`         | `layouts` | `Array`  | Другие раскладки для циклического перебора, в желаемом порядке.                                                    | `["en-US", "es-ES", "de-DE"]`                        |
| `dedicated_layout_hotkeys`  | `hotkeys` | `Array`  | Горячие клавиши для прямого переключения раскладок. Первая = `primary_layout`, остальные = `secondary_layouts` по порядку. | `["^+F8", "^+F9", "^+F10", "^+F11"]`                 |
| `set_primary_layout`        | `hotkeys` | `String` | Горячая клавиша для переключения на основную раскладку.                                                             | `"ScrollLock"`                                       |
| `set_secondary_layout`      | `hotkeys` | `String` | Горячая клавиша для последовательного перебора дополнительных раскладок.                                                      | `"Pause"`                                            |
| `display_current_layout_id` | `hotkeys` | `String` | Горячая клавиша для отображения ID текущей раскладки.                                                               | `"^!+sc017"` (`Ctrl+Shift+Alt+I`)                    |

### Руководство по настройке

#### Шаг 1: Определите ваши раскладки

```json
{
    "layouts": {
        "all_layouts_ordered": ["en-DVORAK", "en-US", "es-ES", "de-DE"],
        "layout_ids": ["-268303351", "67699721", "67767306", "67568647"],
        "primary_layout": "en-DVORAK",
        "secondary_layouts": ["en-US", "es-ES", "de-DE"]
    }
}
```

#### Шаг 2: Настройте горячие клавиши

```json
{
    "hotkeys": {
        "dedicated_layout_hotkeys": ["^+F8", "^+F9", "^+F10", "^+F11"],
        "display_current_layout_id": "^!+sc017",
        "set_primary_layout": "ScrollLock",
        "set_secondary_layout": "Pause"
    }
}
```

### Принцип работы

Последовательное переключение: Нажмите `ScrollLock` для Дворака, затем `Pause` для перебора: QWERTY → Испанская раскладка → Немецкая раскладка → QWERTY...

Выделенные переключение: Нажмите `Ctrl+Shift+F8` для Дворака, `Ctrl+Shift+F9` для QWERTY, `Ctrl+Shift+F10` для Испанской раскладки, `Ctrl+Shift+F11` для Немецкой раскладки.

### Получение ID раскладок

1. Переключитесь на раскладку с помощью языковой панели Windows.
2. Нажмите `Ctrl+Shift+Alt+I` (или вашу настроенную горячую клавишу).
3. Запомните ID, показанный во всплывающей подсказке.
4. Добавьте его в `layout_ids` в ту же позицию, что и название раскладки в `all_layouts_ordered`.

Важно: Порядок критически важен — первый ID в `layout_ids` должен соответствовать первой раскладке в `all_layouts_ordered` и так далее.

<h2 id="layout_switching_techniques">Техники переключения раскладок</h2>

### Техники переключения

| Техника              | Цвет значка в трее | Описание                                                    | Оптимальные сценарии использования                        |
| :--------------------- | :-------------- | :------------------------------------------------------------- | :------------------------------ |
| Windows API            | Синий            | Использует внутренние функции Windows для мгновенного переключения раскладок.  | Большинство приложений, общее использование.         |
| Имитация `Win+Space` | Зелёный           | Имитирует физические нажатия клавиш для максимальной совместимости. | Проблемные приложения, системные области. |

#### Параметры конфигурации

| Параметр                               | Объект     | Тип   | Описание                                          | По умолчанию                           |
| :------------------------------------ | :--------- | :----- | :--------------------------------------------------- | :-------------------------------- |
| `enable_windows_api_layout_switching` | `features` | `Number` | Включить (`1`) или выключить (`0`) переключение через Windows API. | `1`                               |
| `toggle_windows_api_layout_switching` | `hotkeys`  | `String` | Горячая клавиша для переключения между техниками.                    | `"^!+sc019"` (`Ctrl+Shift+Alt+P`) |
| `layout_switching_delay`              | `layouts`  | `Number` | Задержка в миллисекундах для техники `Win+Space`.       | `0`                               |
| `fallback_layout_switching_exes`      | `layouts`  | `Array`  | Приложения, которые всегда должны использовать имитацию `Win+Space`.  | -                              |

### Использование

**Переключение между техниками:**

Нажмите Ctrl+Shift+Alt+P для переключения техник.

Цвет значка будет меняться в зависимости от техники: Синий для Windows API, Зелёный для имитации `Win+Space`.

### Технические детали

#### Техника Windows API

Преимущества: Мгновенное переключение, нет видимых нажатий клавиш.

Ограничения: Не работает, когда активны системные элементы (меню "Пуск", панель задач). Может вызывать зависание определённых приложений, таких как x360ce.

#### Имитация Win+Space

Преимущества: Не вызывает зависания приложений. Надёжно работает в системных областях и проблемных программах.

Ограничения: Требует задержки между нажатиями клавиш. Если задержка слишком большая, ненадолго показывает переключатель раскладок Windows.

Совет: Используйте переключение Windows API для общего использования и добавляйте проблемные приложения в `fallback_layout_switching_exes`, чтобы автоматически переключаться на имитацию `Win+Space` при необходимости.

### Умное управление

Keymeleon интеллектуально обрабатывает особые случаи:

- Системные области (меню "Пуск", рабочий стол): Всегда использует имитацию `Win+Space`.

- Приложения в `fallback_layout_switching_exes`: Всегда используют имитацию `Win+Space`.

- Все остальные ситуации: Использует вашу текущую выбранную технику.

### Настройка задержки

Настройка `layout_switching_delay` обеспечивает надёжную имитацию `Win+Space`:

- Слишком низкая: Нажатия клавиш `Win` и `Space` происходят почти одновременно. Windows может не распознать это как комбинацию клавиш, что приведёт к сбою переключения раскладки.

- Слишком высокая: Создаёт заметную задержку при переключении раскладок. Длительное нажатие клавиши `Win` может случайно активировать сочетания клавиш Windows, если вы продолжите печатать во время задержки.

Рекомендуется: 30-50 миллисекунд для большинства ПК.

**Пример конфигурации:**

```json
{
    "features": {
        "enable_windows_api_layout_switching": 1
    },
    "hotkeys": {
        "toggle_windows_api_layout_switching": "^!+sc019"
    },
    "layouts": {
        "fallback_layout_switching_exes": ["x360ce"],
        "layout_switching_delay": 30
    }
}
```

<h2 id="audio_feedback">Звуковая обратная связь</h2>

Keymeleon предоставляет расширенную звуковую обратную связь для мгновенного определения текущей раскладки и изменений настроек.

### Обзор

Система звуковой обратной связи использует файлы из вашей папки для различных сценариев:

**Звуки переключения раскладок**: Уникальные звуки при смене раскадки.

**Звуки печати**: Различные звуки печати для разных раскладок.

**Звуки изменения настроек**: Звуковые подтверждения включения/выключения функций через горячие клавиши.

### Структура папок

Разместите аудиофайлы в соответствующих папках вашей пользовательской директории:

```text
Keymeleon/
├── audio/
│   ├── layout_switching/ # Звуки переключения раскладок.
│   ├── typing/           # Уникальные звуки печати для каждой раскладки.
│   └── feature_state/    # Звуки для включения/выключения функций.
```

### Базовая настройка

#### Звуки раскладок и печати

Включите функции в вашем объекте `features`:

```json
{
    "features": {
        "enable_layout_switching_audio": 1,
        "enable_typing_audio": 1
    }
}
```
Добавьте аудиофайлы, названные в соответствии с вашими раскладками из `all_layouts_ordered`:

`audio/layout_switching/en-DVORAK.wav`<br>
`audio/layout_switching/en-US.wav`<br>
`audio/typing/en-DVORAK.wav`<br>
`audio/typing/en-US.wav`

#### Звуки изменения настроек

Включите звук переключения настроек:

```json
{
    "features": {
        "enable_feature_state_audio": 1
    }
}
```

Добавьте аудиофайлы с именами `1` и `0`:

`audio/feature_state/1.wav` - Воспроизводится при включении функции.<br>
`audio/feature_state/0.wav` - Воспроизводится при выключении функции.

### Расширенная настройка

Для использования пользовательских имён файлов или других аудиоформатов укажите их в настройках аудио:

```json
{
    "audio": {
        "default_file_extension": "wav",
        "layout_switching": {
            "en-DVORAK": "dvorak_switching.mp3",
            "en-US": "qwerty_switching.ogg"
        },
        "feature_state": {
            "0": "feature_off.mp3",
            "1": "feature_on.mp3"
        },
        "typing": {
            "en-DVORAK": "dvorak_keys.mp3",
            "en-US": "qwerty_keys.wav"
        }
    }
}
```

#### Параметры конфигурации

| Параметр                  | Тип   | Описание                                 | По умолчанию |
| :----------------------- | :----- | :------------------------------------------ | :------ |
| `default_file_extension` | `String` | Аудиоформат по умолчанию для неуказанных файлов. | `wav`   |
| `layout_switching`       | `Object` | Звуки переключения раскладок с произвольными именами файлов.        | `{}`    |
| `feature_state`          | `Object` | Звуки изменения настроек с произвольными именами файлов.       | `{}`    |
| `typing`                 | `Object` | Звуки печати с произвольными именами файлов.               | `{}`    |

<h2 id="features_reference">Функции</h2>

### Конфигурация функций

Объект `features` управляет тем, какие функции Keymeleon активны. Используйте `1` для включения функции и `0` для выключения. Каждую функцию можно переключать с помощью соответствующей горячей клавиши, которая задаётся в объекте `hotkeys`.

**Пример:** Функция `enable_dedicated_layout_switching` управляется горячей клавишей, указанной в `toggle_dedicated_layout_switching`.

### Доступные функции

| Доступные функции                               |	Описание                                                                                                                |
| :------------------------------------ | :------------------------------------------------------------------------------------------------------------------------- |
| `enable_dedicated_layout_switching`   | Включить выделенные горячие клавиши для переключения раскладок (например, `Ctrl+Shift+F8` для `en-DVORAK`, C`trl+Shift+F9` для `en-US`). |
| `enable_sequential_layout_switching`  | Включить последовательное переключение между основной и дополнительными раскладками.                                           |
| `enable_windows_api_layout_switching` | Использовать мгновенное переключение раскладок через Windows API вместо имитации `Win+Space`.                                                |
| `enable_feature_state_audio`          | Воспроизводить звуки при включении или выключении функций через горячие клавиши.                                                               |
| `enable_layout_switching_audio`       | Воспроизводить уникальные звуки при переключении между раскладками.                                                                         |
| `enable_typing_audio`                 | Воспроизводить уникальные звуки печати для разных раскладок клавиатуры.                                                                  |
| `enable_all_bindings`                 | Включить все пользовательские привязки клавиш.                                                                  |

### Горячие клавиши по умолчанию

| Function                              | Hotkey             |
| :------------------------------------ | :----------------- |
| `display_current_layout_id`           | `Ctrl+Shift+Alt+I` |
| `toggle_dedicated_layout_switching`   | `Ctrl+Shift+Alt+[` |
| `toggle_sequential_layout_switching`  | `Ctrl+Shift+Alt+]` |
| `toggle_windows_api_layout_switching` | `Ctrl+Shift+Alt+P` |
| `toggle_layout_switching_audio`       | `Ctrl+Shift+Alt+.` |
| `toggle_feature_state_audio`          | `Ctrl+Shift+Alt+M` |
| `toggle_typing_audio`                 | `Ctrl+Shift+Alt+,` |
| `toggle_all_bindings`                 | `Ctrl+Shift+Alt+/` |

Примечание: Все горячие клавиши настраиваются в объекте `hotkeys` вашей конфигурации.

<h2 id="conditional_layouts">Условные раскладки</h2>

Keymeleon может автоматически переключать раскладки и переназначать клавиши в зависимости от используемого приложения. Он определяет активное окно по имени исполняемого файла (`.exe`) и применяет ваши предустановленные настройки для этого контекста.

### Базовый пример: Игровые и рабочие раскладки

Автоматически переключайте раскладки при переключении на определённые приложениях:

```json
{
    "hotkeys": {
        "context_remap": {
            "exe": {
                "Fallout4": {
                    "enable_layout_switching_audio": 1,
                    "enable_layout_switching_audio_for_automatic_layout_change": 1,
                    "enable_typing_audio": 0,
                    "layout": "en-US"
                },
                "default": {
                    "enable_layout_switching_audio": 1,
                    "enable_typing_audio": 1,
                    "layout": "en-DVORAK"
                }
            }
        }
    }
}
```

Fallout 4 — всего лишь пример — вы можете создавать условные раскладки для любой игры или приложения.

### Идентификация приложений

Keymeleon идентифицирует приложения по имени их исполняемого файла (без расширения `.exe`):

`Fallout4` — Пример: Работает с `Fallout4.exe` (любая игра или приложение)

`default` — Применяется ко всем другим неуказанным приложениям при их активации

Вы можете добавить любое приложение, указав имя его исполняемого файла без расширения `.exe`. Контекст `default` применяется ко всем остальным приложениям, не указанным в настройках.

### Свойства конфигурации

| Свойство                                                    | Тип   | Описание                                                                                                                                     | По умолчанию   |
| :---------------------------------------------------------- | :----- | :---------------------------------------------------------------------------------------------------------------------------------------------- | :-------- |
| `layout`                                                    | `String` | Раскладка для использования в этом контексте (из `all_layouts_ordered`).                                                                                 | -         |
| `enable_layout_switching_audio`                             | `Number` | Воспроизводить звуки переключения раскладок при ручном изменении раскладки в этом контексте.                                                                     | `default` |
| `enable_typing_audio`                                       | `Number` | Включить звуки печати в этом контексте.                                                                                                          | `default` |
| `enable_layout_switching_audio_for_automatic_layout_change` | `Number` | Воспроизводить звуки при автоматическом переключении раскладки при входе в этот контекст или выходе из него. Этот параметр недоступен для контекста `default`.                                          | `1`       |
| `automatic_exe_windows_api_layout_switching_delay`          | `Number` | Задержка в миллисекундах после активации приложения перед автоматическим переключением раскладки. Необходима для приложений, где переключение раскладки происходит некорректно без задержки. | `0`       |
| `binding_disabled_layouts`          | `Array` | Исключающий список для контекстно-зависимой системы привязки клавиш. При переключении на любую раскладку, указанную в этом массиве, система будет игнорировать все записи в `key_bindings` для текущего контекста приложения, фактически отключая пользовательские сопоставления. Названия раскладок должны соответствовать записи в `all_layouts_ordered`. | -       |

<h2 id="context_key_remapping">Контекстное переназначение клавиш</h2>

Keymeleon поддерживает контекстно-зависимое переназначение клавиш, позволяя назначать разные действия для одной и той же клавиши в зависимости от активного приложения.

### Практический пример: Привязка клавиши для конкретного приложения

Настроим клавишу `F2` для выполнения команды "Использовать" (клавиша `E`) в Fallout 4, тогда как в остальных приложениях эта же клавиша будет печатать букву `A`:

```json
{
    "hotkeys": {
        "context_remap": {
            "exe": {
                "Fallout4": {
                    "enable_layout_switching_audio": 1,
                    "enable_layout_switching_audio_for_automatic_layout_change": 1,
                    "enable_typing_audio": 0,
                    "key_bindings": {
                        "f2": {
                            "delay_between": 30,
                            "key": "e"
                        }
                    },
                    "layout": "en-US"
                },
                "default": {
                    "enable_layout_switching_audio": 1,
                    "enable_typing_audio": 1,
                    "key_bindings": {
                        "f2": "a"
                    },
                    "layout": "en-DVORAK"
                }
            },
            "input_bindings": {
                "f2": "F2 Up"
            }
        }
    }
}
```

### Принцип работы

#### Назначаемые клавиши

Объект `input_bindings` определяет, какие физические клавиши будут переназначены:

`f2` — произвольное имя для этой привязки (может быть любым).

`"F2 Up"` — реальная клавиша для отслеживания, где `"Up"` указывает, что действие запускается при отпускании клавиши.

#### Привязки клавиш

Объекты `key_bindings` определяют действия, которые выполняются при нажатии переназначенной клавиши в каждом контексте:

**Контекст Fallout 4:**

```json
{
    "f2": {
        "delay_between": 30,
        "key": "e"
    }
}
```

Поведение: Когда `F2` нажата и отпущена в Fallout 4, подождать 30 миллисекунд, затем имитировать нажатие клавиши `E`.

Применение: Свойство `delay_between` обеспечивает надёжное выполнение в приложениях, которые могут не регистрировать мгновенные нажатия клавиш.

**Контекст по умолчанию:**

```json
"f2": "a"
```

Поведение: Когда `F2` нажата и отпущена в любом другом приложении, немедленно имитировать нажатие клавиши `A`.

Примечание: Как видите, свойство `f2` теперь является простой строкой вместо объекта. Если вам не нужны дополнительные параметры вроде `delay_between`, можно использовать этот сокращённый синтаксис.

#### Принцип работы

Определение клавиши: Keymeleon отслеживает отпускание клавиши `F2` (`"F2 Up"`).

Проверка контекста: Определяет, активно ли окно `Fallout4.exe` или другое приложение.

#### Выполнение действия

В Fallout 4: Ждёт 30мс, затем имитирует нажатие клавиши `E` (команда "Использовать").

В других приложениях: Немедленно имитирует нажатие клавиши `A`.

По сути: Когда окно Fallout 4 активно и вы нажимаете-отпускаете `F2`, ждёт 30 мс, затем выполняет команду "Использовать" (клавиша `E`). В других приложениях нажатие-отпускание `F2` просто печатает `A`.

### Горячие клавиши с модификаторами

Keymeleon может выполнять горячие клавиши с клавишами-модификаторами. Изменим контекст по умолчанию для открытия Диспетчера задач при нажатии `F2`:

```json
{
    "exe": {
        "default": {
            "enable_layout_switching_audio": 1,
            "enable_typing_audio": 1,
            "key_bindings": {
                "f2": {
                    "key": "Esc",
                    "modifiers": ["Ctrl", "Shift"]
                }
            }
        }
    },
    "input_bindings": {
        "f2": "F2 Up"
    }
}
```

Свойство modifiers указывает Keymeleon удерживать `Ctrl` и `Shift` перед нажатием `Esc`. Это создаёт сочетание `Ctrl+Shift+Esc`, открывающее Диспетчер задач.

#### Примечания по использованию

Для одного модификатора можно использовать строку вместо массива: `"modifiers": "Ctrl"`.

Если добавить свойство `delay_between` (например, 30 мс), задержка будет применена между каждым нажатием клавиш в последовательности.

Добавление задержки может помочь, если горячая клавиша работает нестабильно в некоторых приложениях.

### Блокировка стандартной функции клавиши

Чтобы отключить исходное поведение клавиши, установите параметр `allow_native_function` в значение `0`.

В этом примере мы переназначаем `Left Win` для открытия справки браузера (`F1`) вместо меню "Пуск":

```json
{
    "context_remap": {
        "exe": {
            "default": {
                "key_bindings": {
                    "lwin": {
                        "allow_native_function": 0,
                        "key": "F1"
                    }
                }
            }
        },
        "input_bindings": {
            "lwin": "LWin Up"
        }
    }
}
```

### Игнорирование удерживаемых модификаторов
Если переназначенная клавиша всё ещё не работает, попробуйте установить `ignore_modifiers` в значение `1`. Это указывает Keymeleon игнорировать любые клавиши-модификаторы (`Ctrl`, `Shift`, `Alt`), которые вы удерживаете при нажатии переназначенной клавиши.

Используйте этот параметр вместе или вместо `allow_native_function` при устранении неполадок с неотзывчивыми горячими клавишами.

### Ожидание отпускания клавиши

Свойство `wait` включает функцию удерживания клавиши, заставляя Keymeleon ждать, пока вы отпустите физическую клавишу, прежде чем отправить событие `"Up"` в целевое приложение. Это необходимо для действий, требующих удерживания клавиши, таких как механика «удерживать для перезарядки» или контекстно-зависимые действия, которые различаются между короткими нажатиями и долгим удержанием.

#### Пример: Перезарядка с функцией удержания для убирания оружия

В Fallout 4 клавиша `R` имеет двойную функцию:

Короткое нажатие: Перезарядить оружие

Долгое удержание: Убрать оружие

Чтобы правильно привязать это действие к `F2`, скрипту необходимо ждать отпускания клавиши:

```json
{
    "hotkeys": {
        "context_remap": {
            "exe": {
                "Fallout4": {
                    "enable_layout_switching_audio": 1,
                    "enable_layout_switching_audio_for_automatic_layout_change": 1,
                    "enable_typing_audio": 0,
                    "key_bindings": {
                        "f2": {
                            "allow_native_function": 0,
                            "key": "r",
                            "wait": 1
                        },
                        "f3_sc": {
                            "allow_native_function": 0,
                            "key": "r",
                            "key_wait": "f3"
                        }
                    },
                    "layout": "en-US"
                },
                "default": {
                    "enable_layout_switching_audio": 1,
                    "enable_typing_audio": 1,
                    "key_bindings": {
                        "f2": "a"
                    },
                    "layout": "en-DVORAK"
                }
            },
            "input_bindings": {
                "f2": "F2",
                "f3_sc": "SC03D"
            }
        }
    }
} 
```

#### Принцип работы

Стандартные названия клавиш (например, `F2`): Когда вы устанавливаете `"wait": 1`, Keymeleon автоматически отслеживает, когда вы отпускаете `F2`, и отправляет событие `"r Up"` только после того, как вы отпустили физическую клавишу.

Скан-коды (например, `SC03D` для `F3`): Keymeleon не может автоматически определять, какая физическая клавиша соответствует скан-коду. Вы должны явно указать `"key_wait": "f3"`, чтобы сообщить скрипту, какую физическую клавишу отслеживать для отпускания.

### Таймаут отпускания модификаторов
#### Проблемная ситуация

При активации горячей клавиши, которая использует клавиши-модификаторы (`Ctrl`, `Shift`, `Alt`), вы можете случайно вызвать не ту команду, если эти модификаторы всё ещё физически нажаты.

#### Пример:

Вы настраиваете горячую клавишу `Ctrl+Shift+F2` для выполнения `Ctrl+V` (вставить с сохранением форматирования).

Удерживая `Ctrl` и `Shift` для нажатия `F2`, Windows может зарегистрировать `Ctrl+Shift+V` (вставить без форматирования) вместо ожидаемого `Ctrl+V`.

#### Решение: modifiers_release_timeout

Это свойство указывает Keymeleon ждать указанное количество миллисекунд, пока вы отпустите нажатые клавиши-модификаторы, перед выполнением целевой команды.

#### Как это работает:

1. Вы нажимаете горячую клавишу (например, `Ctrl+Shift+F2`).
2. Keymeleon обнаруживает, что модификаторы `Ctrl` и `Shift` всё ещё нажаты.
3. Он ждёт до указанного таймаута (например, 1000 мс), пока вы их отпустите.
4. Как только все модификаторы будут отпущены ИЛИ таймаут истечёт, выполняется команда `Ctrl+V`.

#### Пример конфигурации

```json
{
    "context_remap": {
        "exe": {
            "default": {
                "key_bindings": {
                    "ctrl_shift_f2": {
                        "allow_native_function": 0,
                        "key": "v",
                        "modifiers": ["Ctrl"],
                        "modifiers_release_timeout": 1000
                    },
                }
            }
        },
        "input_bindings": {
            "ctrl_shift_f2": "^+F2",
        }
    }
}
```

### Свойства привязки клавиш

| Свойство                | Тип         | Описание                                                                                                                                                                                                                                                                          | По умолчанию |
| :---------------------- | :----------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------ |
| `key`                   | `String`       | Клавиша или комбинация клавиш для выполнения при срабатывании привязки.                                                                                                                                                                                                               | -       |
| `delay_before`                 | `Number`       | Задержка в миллисекундах между нажатием привязанной клавиши и выполнением целевого действия. | `0`     |
| `delay_between`                 | `Number`       | Задержка в миллисекундах в миллисекундах между отдельными нажатиями клавиш при выполнении действия. Некоторые приложения реагируют мгновенно, другие вроде Fallout 4 требуют краткой задержки (обычно 30-50мс) для срабатывания имитированного нажатия. | `0`     |
| `wait`                 | `Number`       | Ждать отпускания физической клавиши перед отправкой события `"Up".` | `0`     |
| `key_wait`                 | `String`       | Имя физической клавиши для отслеживания отпускания. | -     |
| `modifiers`             | `Array/String` | Клавиши-модификаторы для удерживания.                                                                                                                                                                                                                                                               | -       |
| `allow_native_function` | `Number`       | Разрешить (`1`) или блокировать (`0`) исходную функцию клавиши. Например, установите `0`, чтобы предотвратить открытие меню "Пуск" при переназначении клавиши `Win`.                                                                                                                                   | `1`     |
| `ignore_modifiers`      | `Number`       | Игнорировать (`1`) или учитывать (`0`) клавиши-модификаторы, уже удерживаемые при срабатывании привязки.                                                                                                                                                                                            | `0`     |
| `modifiers_release_timeout`      | `Number`       | Время в миллисекундах, в течение которого Keymeleon ожидает отпускания физически нажатых клавиш-модификаторов перед выполнением целевой команды. Если таймаут истекает раньше, чем модификаторы были отпущены, команда выполняется немедленно.                                                                                                                                                                                            | `0`     |
| `repeat_count`      | `Number`       | Количество повторений всей последовательности макроса.                                                                                                                                                                                            | `1`     |

<h2 id="macros">Макросы</h2>

Keymeleon поддерживает сложные макросы — последовательности клавиш и задержек, выполняемые по нажатию одной горячей клавиши.

### Пример 1: Текст с прогрессивными задержками

Данный макрос печатает слово "test" с постепенно увеличивающимися паузами между символами:

```json
{
    "exe": {
        "default": {
            "key_bindings": {
                "f2": [
                    {
                        "key": "t"
                    },
                    {
                        "delay": 100
                    },
                    {
                        "key": "e"
                    },
                    {
                        "delay": 200
                    },
                    {
                        "key": "s"
                    },
                    {
                        "delay": 400
                    },
                    {
                        "key": "t"
                    }
                ]
            }
        }
    },
    "input_bindings": {
        "f2": "F2 Up"
    }
}
```
### Пример 2: Выделение всего текста и вставка

Данный макрос выполняет операцию "Выделить всё" с последующей вставкой содержимого буфера обмена:

```json
{
    "exe": {
        "default": {
            "key_bindings": {
                "f2": [
                    {
                        "key": "Ctrl Down"
                    },
                    {
                        "delay": 300
                    },
                    {
                        "key": "a"
                    },
                    {
                        "delay": 300
                    },
                    {
                        "key": "Ctrl Up"
                    },
                    {
                        "delay": 300
                    },
                    {
                        "key": "Ctrl Down"
                    },
                    {
                        "delay": 300
                    },
                    {
                        "key": "v"
                    },
                    {
                        "delay": 300
                    },
                    {
                        "key": "Ctrl Up"
                    }
                ]
            }
        }
    },
    "input_bindings": {
        "f2": "F2 Up"
    }
}
```

### Макросы с расширенными свойствами

Чтобы использовать `allow_native_function`, `ignore_modifiers`, `wait` и `key_wait` с макросами, оберните массив макроса в объект. Эта структура объекта также позволяет указать свойство `repeat_count` для многократного выполнения макроса подряд:

```json
{
    "exe": {
        "default": {
            "key_bindings": {
                "ctrl_shift_esc": {
                    "allow_native_function": 0,
                    "macro": [
                        {
                            "key": "t"
                        },
                        {
                            "delay": 100
                        },
                        {
                            "key": "e"
                        },
                        {
                            "delay": 200
                        },
                        {
                            "key": "s"
                        },
                        {
                            "delay": 400
                        },
                        {
                            "key": "t"
                        }
                    ],
                    "repeat_count": 3
                }
            }
        }
    },
    "input_bindings": {
        "ctrl_shift_esc": "^+Esc"
    }
}
```

Эта конфигурация печатает "test" три раза при нажатии `Ctrl+Shift+Esc`, предотвращая открытие Диспетчера задач.

Вы можете повторять определённые части макроса независимо друг от друга, используя вложенные объекты макросов:

```json
{
    "exe": {
        "default": {
            "key_bindings": {
                "ctrl_shift_esc": {
                    "allow_native_function": 0,
                    "macro": [
                        {
                            "macro": [
                                {
                                    "key": "t"
                                },
                                {
                                    "delay": 100
                                },
                                {
                                    "key": "e"
                                },
                                {
                                    "delay": 200
                                },
                                {
                                    "key": "s"
                                },
                                {
                                    "delay": 400
                                },
                                {
                                    "key": "t"
                                },
                                {
                                    "delay": 600
                                },
                                {
                                    "key": "2"
                                }
                            ],
                            "repeat_count": 2
                        },
                        {
                            "macro": [
                                {
                                    "key": "Space"
                                }
                            ]
                        },
                        {
                            "macro": [
                                {
                                    "key": "t"
                                },
                                {
                                    "delay": 100
                                },
                                {
                                    "key": "e"
                                },
                                {
                                    "delay": 200
                                },
                                {
                                    "key": "s"
                                },
                                {
                                    "delay": 400
                                },
                                {
                                    "key": "t"
                                },
                                {
                                    "delay": 600
                                },
                                {
                                    "key": "4"
                                }
                            ],
                            "repeat_count": 4
                        }
                    ]
                }
            }
        }
    },
    "input_bindings": {
        "ctrl_shift_esc": "^+Esc"
    }
}
```

Эта конфигурация печатает "test2" дважды, добавляет пробел, затем печатает "test4" четыре раза.

<h2 id="mouse_button_support">Поддержка кнопок мыши</h2>

Keymeleon позволяет использовать дополнительные кнопки мыши через их предварительную привязку к функциональным клавишам в ПО мыши с последующей настройкой в Keymeleon.

### Процесс настройки

Привяжите дополнительные кнопки мыши к неиспользуемым функциональным клавишам (`F13`-`F24`) в программном обеспечении мыши. Для записи этих клавиш в программном обеспечении мыши используйте предоставленный вспомогательный скрипт `f24.ahk`: запустите скрипт, затем нажмите физическую функциональную клавишу, которую хотите сопоставить (например, `F12` сопоставляется с `F24`, `F11` — с `F23` и так далее).

Назначьте эти клавиши как горячие клавиши в Keymeleon.

### Пример: Конфигурация MMO мыши
Данная конфигурация назначает 10 кнопок MMO мыши на цифровые клавиши быстрого доступа (1-0) в Fallout 4, при этом первые две кнопки используются для операций Копирования/Вставки в остальных приложениях:

```json
{
    "context_remap": {
        "exe": {
            "Fallout4": {
                "enable_layout_switching_audio": 1,
                "enable_layout_switching_audio_for_automatic_layout_change": 1,
                "enable_typing_audio": 0,
                "key_bindings": {
                    "button_1": {
                        "key": 1,
                        "wait": 1
                    },
                    "button_10": {
                        "key": 0,
                        "wait": 1
                    },
                    "button_1_alt": {
                        "key": "k",
                        "wait": 1
                    },
                    "button_2": {
                        "key": 2,
                        "wait": 1
                    },
                    "button_2_alt": {
                        "key": "i",
                        "wait": 1
                    },
                    "button_3": {
                        "key": 3,
                        "wait": 1
                    },
                    "button_3_alt": {
                        "key": "j",
                        "wait": 1
                    },
                    "button_4": {
                        "key": 4,
                        "wait": 1
                    },
                    "button_4_alt": {
                        "key": "m",
                        "wait": 1
                    },
                    "button_5": {
                        "key": 5,
                        "wait": 1
                    },
                    "button_5_alt": {
                        "key": "o",
                        "wait": 1
                    },
                    "button_6": {
                        "key": 6,
                        "wait": 1
                    },
                    "button_7": {
                        "key": 7,
                        "wait": 1
                    },
                    "button_8": {
                        "key": 8,
                        "wait": 1
                    },
                    "button_9": {
                        "key": 9,
                        "wait": 1
                    },
                    "dpi+": {
                        "key": "F9",
                        "wait": 1
                    },
                    "dpi-": {
                        "key": "F5",
                        "wait": 1
                    }
                },
                "layout": "en-US"
            },
            "default": {
                "enable_layout_switching_audio": 1,
                "enable_typing_audio": 1,
                "key_bindings": {
                    "button_1": {
                        "key": "c",
                        "modifiers": "Ctrl"
                    },
                    "button_2": {
                        "key": "v",
                        "modifiers": "Ctrl"
                    }
                },
                "layout": "en-DVORAK"
            }
        },
        "input_bindings": {
            "button_1": "F13",
            "button_10": "F22",
            "button_11": "F23",
            "button_12": "F24",
            "button_1_alt": "!F13",
            "button_2": "F14",
            "button_2_alt": "!F14",
            "button_3": "F15",
            "button_3_alt": "!F15",
            "button_4": "F16",
            "button_4_alt": "!F16",
            "button_5": "F17",
            "button_5_alt": "!F17",
            "button_6": "F18",
            "button_7": "F19",
            "button_8": "F20",
            "button_9": "F21",
            "dpi+": "^F13",
            "dpi-": "^F14"
        }
    }
}
```

### Принцип работы

В Fallout 4: Кнопки мыши 1-10 активируют меню избранного с цифровыми клавишами (`1`-`0`). Клавиша `Alt` в сочетании с кнопками 1-5 открывает различные внутриигровые меню (Pip-Boy). Кнопки DPI используются для быстрой загрузки (`F9`) и быстрого сохранения (`F5`).

На рабочем столе: Кнопки мыши 1-2 активируют `Ctrl+C` и `Ctrl+V` соответственно.

Кнопки мыши 3-10 не имеют специальной функции на рабочем столе в этой конфигурации.

Этот подход даёт полный контроль над кнопками мыши для разных приложений, сохраняя стандартную функциональность в других местах.

<h2 id="remapping_keyboard_keys_and_hotkeys">Переназначение клавиш и горячих клавиш</h2>

Подобно кнопкам мыши, вы можете переназначать любую клавишу или сочетание клавиш для имитации другой клавиши или сочетания клавиши.

### Простой пример

В этом примере мы назначаем комбинацию `Alt+T` для открытия Диспетчера задач (`Ctrl+Shift+Esc`):

```json
{
    "context_remap": {
        "exe": {
            "default": {
                "enable_layout_switching_audio": "default",
                "enable_typing_audio": "default",
                "key_bindings": {
                    "alt_t": {
                        "allow_native_function": 0,
                        "key": "Esc",
                        "modifiers": [
                            "Ctrl",
                            "Shift"
                        ]
                    }
                },
                "layout": "en-DVORAK"
            }
        },
        "input_bindings": {
            "alt_t": "!t"
        }
    }
}
```

### Универсальные сочетания клавиш для всех раскладок

В следующем примере мы создаём универсальные привязки для общих функций Windows (Выделить всё, Копировать, Вставить и т.д.). Эта конфигурация гарантирует, что сочетания клавиш работают на основе физического расположения клавиш, а не символов конкретной раскладки. Например, вы сможете вставлять текст, нажимая физическое сочетание `Ctrl+V`, независимо от того, используете ли вы раскладку QWERTY, Дворак или любую другую.

Конфигурация сопоставляет физические позиции клавиш (с использованием скан-кодов) с соответствующими функциями Windows, сохраняя неизменную мышечную память при переключении между различными раскладками клавиатуры.

json

```json
{
    "context_remap": {
        "exe": {
            "default": {
                "enable_layout_switching_audio": "default",
                "enable_typing_audio": "default",
                "key_bindings": {
                    "ctrl_;": {
                        "allow_native_function": 0,
                        "key": "z",
                        "modifiers": [
                            "Ctrl"
                        ]
                    },
                    "ctrl_a": {
                        "allow_native_function": 0,
                        "key": "a",
                        "modifiers": [
                            "Ctrl"
                        ]
                    },
                    "ctrl_b": {
                        "allow_native_function": 0,
                        "key": "n",
                        "modifiers": [
                            "Ctrl"
                        ]
                    },
                    "ctrl_d": {
                        "allow_native_function": 0,
                        "key": "h",
                        "modifiers": [
                            "Ctrl"
                        ]
                    },
                    "ctrl_f": {
                        "allow_native_function": 0,
                        "key": "y",
                        "modifiers": [
                            "Ctrl"
                        ]
                    },
                    "ctrl_j": {
                        "allow_native_function": 0,
                        "key": "c",
                        "modifiers": [
                            "Ctrl"
                        ]
                    },
                    "ctrl_k": {
                        "allow_native_function": 0,
                        "key": "v",
                        "modifiers": [
                            "Ctrl"
                        ]
                    },
                    "ctrl_o": {
                        "allow_native_function": 0,
                        "key": "s",
                        "modifiers": [
                            "Ctrl"
                        ]
                    },
                    "ctrl_shift_k": {
                        "allow_native_function": 0,
                        "key": "v",
                        "modifiers": [
                            "Ctrl",
                            "Shift"
                        ]
                    },
                    "ctrl_shift_o": {
                        "allow_native_function": 0,
                        "key": "s",
                        "modifiers": [
                            "Ctrl",
                            "Shift"
                        ]
                    },
                    "ctrl_shift_q": {
                        "allow_native_function": 0,
                        "key": "x",
                        "modifiers": [
                            "Ctrl"
                        ]
                    },
                    "ctrl_u": {
                        "allow_native_function": 0,
                        "key": "f",
                        "modifiers": [
                            "Ctrl"
                        ]
                    },
                },
                "layout": "en-DVORAK"
            }
        },
        "input_bindings": {
            "ctrl_;": "^SC02C",
            "ctrl_a": "^SC01E",
            "ctrl_b": "^SC031",
            "ctrl_d": "^SC023",
            "ctrl_f": "^SC015",
            "ctrl_j": "^SC02E",
            "ctrl_k": "^SC02F",
            "ctrl_o": "^SC01F",
            "ctrl_shift_k": "^+SC02F",
            "ctrl_shift_o": "^+SC01F",
            "ctrl_shift_q": "^+SC02D",
            "ctrl_u": "^SC021",
        }
    }
}
```
#### Руководство по настройке

1. В `input_bindings` укажите физическое положение клавиши с помощью скан-кодов. Например, используйте `SC02F` для клавиши, которая печатает `K` в раскладке Дворак (и `V` в QWERTY), независимо от того, какой символ она печатает в вашей активной раскладке.

2. В `key_bindings` определите фактическую функцию Windows для выполнения. Для функции вставки это будет `V` с модификатором `Ctrl` для имитации `Ctrl+V`.

3. Всегда добавляйте `"allow_native_function": 0`, чтобы отключить оригинальное поведение, зависящее от раскладки, и обеспечить неизменное выполнение сочетаний клавиш во всех раскладках.

<h2 id="reference">Справочник</h2>

### Объект `layouts`

| Параметр                     | Тип     | Описание                                                                                     | Пример                                              | По умолчанию |
| :-------------------------- | :------- | :---------------------------------------------------------------------------------------------- | :--------------------------------------------------- | :------ |
| `all_layouts_ordered`       | `Array`  | Названия всех раскладок в точном порядке языковой панели Windows. Названия должны быть уникальными. | `["en-DVORAK", "en-US", "es-ES", "de-DE"]`           | -       |
| `layout_ids`                | `Array`  | ID раскладок, соответствующие `all_layouts_ordered`. Получить ID можно с помощью `Ctrl+Shift+Alt+I`. | `["-268303351", "67699721", "67767306", "67568647"]` | -       |
| `primary_layout`            | `String` | Название вашей раскладки по умолчанию из `all_layouts_ordered`. | `"en-DVORAK"`                                        | -       |
| `secondary_layouts`         | `Array`  | Другие раскладки для циклического перебора, в желаемом порядке. | `["en-US", "es-ES", "de-DE"]`                        | -       |
| `fallback_layout_switching_exes` | `Array` | Приложения, которые всегда должны использовать имитацию `Win+Space`. | `["x360ce"]` | -    |
| `layout_switching_delay`    | `Number` | Задержка в миллисекундах для техники `Win+Space`. | `30` | `0`     |

### Объект `hotkeys`

| Параметр                     | Тип     | Описание                                                                                     | Пример                                              | По умолчанию |
| :-------------------------- | :------- | :---------------------------------------------------------------------------------------------- | :--------------------------------------------------- | :------ |
| `dedicated_layout_hotkeys`  | `Array`  | Горячие клавиши для прямого переключения раскладок. Первая = `primary_layout`, остальные = `secondary_layouts` по порядку. | `["^+F8", "^+F9", "^+F10", "^+F11"]` (Ctrl+Shift+F8–F11) | -       |
| `set_primary_layout`        | `String` | Горячая клавиша для переключения на основную раскладку. | `"ScrollLock"`                                       | -       |
| `set_secondary_layout`      | `String` | Горячая клавиша для последовательного перебора дополнительных раскладок. | `"Pause"`                                            | -       |
| `display_current_layout_id` | `String` | Горячая клавиша для отображения ID текущей раскладки. | `"^!+sc017"` (`Ctrl+Shift+Alt+I`)                    | -       |
| `toggle_dedicated_layout_switching` | `String` | Горячая клавиша для переключения функции выделенного переключения раскладок. | `"^!+sc01A"` (`Ctrl+Shift+Alt+[`) | - |
| `toggle_sequential_layout_switching` | `String` | Горячая клавиша для переключения последовательного переключения раскладок. | `"^!+sc01B"` (`Ctrl+Shift+Alt+]`) | - |
| `toggle_windows_api_layout_switching` | `String` | Горячая клавиша для включения/выключения переключения раскладок через Windows API. | `"^!+sc019"` (`Ctrl+Shift+Alt+P`) | - |
| `toggle_feature_state_audio` | `String` | Горячая клавиша для переключения звука состояния функций. | `"^!+sc032"` (`Ctrl+Shift+Alt+M`) | - |
| `toggle_layout_switching_audio` | `String` | Горячая клавиша для переключения звука переключения раскладок. | `"^!+sc034"` (`Ctrl+Shift+Alt+.`) | - |
| `toggle_typing_audio` | `String` | Горячая клавиша для переключения звука печати. | `"^!+sc033"` (`Ctrl+Shift+Alt+,`) | - |
| `enable_all_bindings` | `String` | Горячая клавиша для включения/выключения всех пользовательских привязок клавиш. | `"^!+sc035"` (`Ctrl+Shift+Alt+/`) | - |

### Объект `features`

Каждое свойство принимает только два значения: `1` (включено) или `0` (выключено).

| Параметр                               | Тип     | Описание                                                                 | По умолчанию |
| :------------------------------------ | :------- | :-------------------------------------------------------------------------- | :------ |
| `enable_dedicated_layout_switching`   | `Number` | Включить выделенные горячие клавиши для переключения раскладок (например, `Ctrl+Shift+F8` для `en-DVORAK`, C`trl+Shift+F9` для `en-US`). | `1`     |
| `enable_sequential_layout_switching`  | `Number` | Включить последовательное переключение между основной и дополнительными раскладками. | `1`     |
| `enable_windows_api_layout_switching` | `Number` | Использовать мгновенное переключение раскладок через Windows API вместо имитации `Win+Space`. | `1`     |
| `enable_feature_state_audio`          | `Number` | Воспроизводить звуки при включении или выключении функций через горячие клавиши. | `1`     |
| `enable_layout_switching_audio`       | `Number` | Воспроизводить уникальные звуки при переключении между раскладками. | `1`     |
| `enable_typing_audio`                 | `Number` | Воспроизводить уникальные звуки печати для разных раскладок клавиатуры. | `1`     |
| `enable_all_bindings`                 | `Number` | Включить все пользовательские привязки клавиш. | `1`     |

### Объект `context_remap` (внутри `hotkeys`)

| Параметр           | Тип     | Описание                                                                 | По умолчанию |
| :---------------- | :------- | :-------------------------------------------------------------------------- | :------ |
| `exe`             | `Object` | Конфигурации для конкретных приложений. Содержит имена исполняемых файлов в качестве ключей. | -       |
| `input_bindings`  | `Object` | Физические клавиши для переназначения, с пользовательскими именами в качестве ключей и горячими клавишами в качестве значений. | -       |

### Объект `exe` (внутри `context_remap`)

| Параметр           | Тип     | Описание                                                                 | Пример | По умолчанию |
| :---------------- | :------- | :-------------------------------------------------------------------------- | :------ | :------ |
| `[Имя exe приложения]` | `Object` | Конфигурация для конкретного приложения (используйте имя файла .exe без расширения). | `"Fallout4"` | -       |
| `default`         | `Object` | Конфигурация, применяемая ко всем неуказанным приложениям. | -       | -       |

### `[имя exe приложения]` (внутри объектов `exe`)

| Параметр                                                    | Тип   | Описание                                                                 | Пример | По умолчанию   |
| :--------------------------------------------------------- | :----- | :-------------------------------------------------------------------------- | :------ | :-------- |
| `layout`                                                   | `String` | Раскладка для использования в этом контексте (из `all_layouts_ordered`). | `"en-US"` | -         |
| `enable_layout_switching_audio`                            | `Number` | Воспроизводить звуки переключения раскладок при ручном изменении раскладки в этом контексте. | `1` | `default` |
| `enable_typing_audio`                                      | `Number` | Включить звуки печати в этом контексте. | `1` | `default` |
| `enable_layout_switching_audio_for_automatic_layout_change`| `Number` | Воспроизводить звуки при автоматическом переключении раскладки при входе в этот контекст или выходе из него. Этот параметр недоступен для контекста `default`. | `0` | `1`       |
| `automatic_exe_windows_api_layout_switching_delay`         | `Number` | Задержка в миллисекундах после активации приложения перед автоматическим переключением раскладки. Необходима для приложений, где переключение раскладки происходит некорректно без задержки. | `1000` | `0`       |
| `key_bindings`                                             | `Object` | Переназначения клавиш, специфичные для этого контекста приложения. | `{"f2": "a"}` | -         |
| `binding_disabled_layouts`                                 | `Array` | Исключающий список для контекстно-зависимой системы привязки клавиш. При переключении на любую раскладку, указанную в этом массиве, система будет игнорировать все записи в `key_bindings` для текущего контекста приложения, фактически отключая пользовательские сопоставления. Названия раскладок должны соответствовать записи в `all_layouts_ordered`. | `["en-DVORAK", "es-ES", "de-DE"]` | -         |

### Объект `input_bindings` (внутри `context_remap`)

| Параметр           | Тип     | Описание                                                                 | Пример | По умолчанию |
| :---------------- | :------- | :-------------------------------------------------------------------------- | :------ | :------ |
| `[пользовательское имя привязки]`   | `String` | Пользовательское имя привязки (может быть любым), сопоставленное с горячей клавишей. | `"f2": "F2 Up"` | -       |

### Объект `key_bindings` (внутри `[имя exe приложения]`)

| Параметр                | Тип         | Описание                                                                 | Пример | По умолчанию |
| :--------------------- | :----------- | :-------------------------------------------------------------------------- | :------ | :------ |
| `[пользовательское имя привязки]`        | `String/Object` | Действие для выполнения, либо как простая строка, либо как объект конфигурации. | `"a"` или `{"key": "e", "delay_between": 30}` | -       |

### Объект `[пользовательское имя привязки]` (внутри `key_bindings`)

| Свойство                | Тип         | Описание                                                                                                                                                                                                                  | Пример | По умолчанию |
| :--------------------- | :----------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------ | :------ |
| `key`                  | `String`     | Клавиша или комбинация клавиш для выполнения при срабатывании привязки.                                                                                                                                                               | `"a"` | -       |
| `delay_before`         | `Number`     | Задержка в миллисекундах между нажатием привязанной клавиши и выполнением целевого действия.                                                                                                  | `30` | `0`     |
| `delay_between`        | `Number`     | Задержка в миллисекундах в миллисекундах между отдельными нажатиями клавиш при выполнении действия. Некоторые приложения реагируют мгновенно, другие вроде Fallout 4 требуют краткой задержки (обычно 30-50мс) для срабатывания имитированного нажатия. | `30` | `0`     |
| `wait`                 | `Number`     | Ждать отпускания физической клавиши перед отправкой события `"Up"`.                                                                                                                                                                     | `1` | `0`     |
| `key_wait`             | `String`     | Имя физической клавиши для отслеживания отпускания.                                                                                                                                                                                    | `"f3"` | -       |
| `modifiers`            | `Array/String` | Клавиши-модификаторы для удерживания.                                                                                                                                                                                                       | `["Ctrl", "Shift"]` | -       |
| `allow_native_function`| `Number`     | Разрешить (`1`) или блокировать (`0`) исходную функцию клавиши. Например, установите `0`, чтобы предотвратить открытие меню "Пуск" при переназначении клавиши `Win`.                                                                         | `0` | `1`     |
| `ignore_modifiers`     | `Number`     | Игнорировать (`1`) или учитывать (`0`) клавиши-модификаторы, уже удерживаемые при срабатывании привязки.                                                                                                                                    | `1` | `0`     |
| `modifiers_release_timeou`     | `Number`     | Время в миллисекундах, в течение которого Keymeleon ожидает отпускания физически нажатых клавиш-модификаторов перед выполнением целевой команды. Если таймаут истекает раньше, чем модификаторы были отпущены, команда выполняется немедленно.                                                                                                                                    | `300` | `0`     |
| `macro`                | `Array`      | Последовательность клавиш и задержек для сложных макросов.                                                                                                                                                                              | `[{"key": "a"}, {"delay": 50}, {"key": "b"}]` | -       |
| `repeat_count`         | `Number`     | Количество повторений всей последовательности макроса.                                                                                                                                                                         | `3` | `1`     |

### Макрос

| Свойство       | Тип     | Описание                                                                                           | Пример | По умолчанию |
| :------------- | :------- | :---------------------------------------------------------------------------------------------------- | :------ | :------ |
| `key`          | `String` | Клавиша для нажатия на этом шаге последовательности макроса.                                                  | `"t"` | -       |
| `delay`        | `Number` | Задержка в миллисекундах перед выполнением следующего элемента в последовательности макроса.                           | `100` | `0`     |
| `wait`         | `Number` | Ждать отпускания физической клавиши перед отправкой события `"Up"`.                                              | `1` | `0`     |
| `key_wait`     | `String` | Имя физической клавиши для отслеживания отпускания.                                                             | `"f2"` | -       |
| `macro`        | `Array`  | Создает вложенный макрос, который можно выполнить как единый блок, опционально с собственным `repeat_count`. | `[{"key": "a"}, {"delay": 50}, {"key": "b"}]` | -       |
| `repeat_count` | `Number` | Количество повторений всей последовательности макроса.      | `3` | `1`     |